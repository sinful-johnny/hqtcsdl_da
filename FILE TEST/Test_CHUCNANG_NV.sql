use QL_NHAKHOA
go

exec sp_ThemTK 'lolo', '012345678', '2003/10/20', 'hhihi@gmail.com', '123', 'NV'
exec sp_ThemTK 'loNHASI', '012340078', '2003/10/20', 'hhihi@gmail.com', '123', 'NS'
exec sp_ThemTK 'loKHACHHANG', '012345318', '2003/10/20', 'hhihGIi@gmail.com', '123', 'KH'
exec sp_ThemTK 'loKHACHHANG1', '012235318', '2003/10/20', 'hhihGIi@gmail.com', '123', 'KH'
go

INSERT INTO LICH_LAM_VIEC(ID_LLV,NGAYKHAM,GIOKHAM,TRANGTHAI,ID_NS) VALUES
(cast(NEWID() as varchar(255)), '2023-12-31', '09:00:00', N'Trống',		(select ID_TAIKHOAN from TAI_KHOAN where SDT = '09992233445')),
(cast(NEWID() as varchar(255)), '2024-1-13', '10:30:00', N'Trống',		(select ID_TAIKHOAN from TAI_KHOAN where SDT = '07788994437')),
(cast(NEWID() as varchar(255)), '2024-1-1', '14:00:00', N'Trống',		(select ID_TAIKHOAN from TAI_KHOAN where SDT = '05673219876'));
go
-- XEM LICH KHAM
EXEC SP_NV_XEMLICHKHAM
GO
-- XEM LICH LAM VIEC
EXEC SP_NV_XEMLICHLAMVIEC
GO

-- XEM HOA DON
EXEC SP_NV_XEMHOADON
GO

-- XEM TT THUOC
EXEC SP_NV_XEMTTTHUOC
GO

-- XEM THUOC SD
EXEC SP_NV_XEMDANHMUC_THUOCSD
GO
-- XEM DICH VU
EXEC SP_NV_XEMDICHVU_SD
GO

-- Lựa chọn ID_TAIKHOAN từ bảng TAI_KHOAN dựa trên SDT
DECLARE @ID_KH1 VARCHAR(255)
DECLARE @ID_KH2 VARCHAR(255)
DECLARE @ID_NV VARCHAR(255)
SELECT @ID_KH1 = ID_TAIKHOAN FROM TAI_KHOAN WHERE SDT = '012345318'
SELECT @ID_KH2 = ID_TAIKHOAN FROM TAI_KHOAN WHERE SDT = '012235318'
SELECT @ID_NV = ID_TAIKHOAN FROM TAI_KHOAN WHERE SDT = '012345678'

EXEC SP_NV_THEMLICHKHAM @ID_KH1, @ID_NV, '2024-01-01', '14:00:00.0000000'
EXEC SP_NV_THEMLICHKHAM @ID_KH2, @ID_NV, '2023-12-31', '09:00:00.0000000'
go

SELECT *
FROM TAI_KHOAN
WHERE LOAITK = 'KH'

SELECT *
FROM LICH_DAT_KHAM

delete 
from LICH_DAT_KHAM

UPDATE LICH_LAM_VIEC
SET TRANGTHAI = N'Trống';

SELECT *
FROM LICH_LAM_VIEC

SELECT * 
FROM TAI_KHOAN
WHERE HOTEN = 'loKHACHHANG1'

-- them hoa don
-- them thong tin test
INSERT INTO LOAI_DV(ID_LOAIDV, TENDV, GIATIEN) VALUES
(cast(NEWID() as varchar(255)), N'Dịch vụ 1', 100000),
(cast(NEWID() as varchar(255)), N'Dịch vụ 2', 10000),
(cast(NEWID() as varchar(255)), N'Dịch vụ 3', 200000),
(cast(NEWID() as varchar(255)),N'Trám răng',200),
(cast(NEWID() as varchar(255)),N'Trồng răng',1000)

insert BENH_AN(ID_BA,ID_KH,ID_NS,NGAYKHAM)
values
(cast(NEWID() as varchar(255)),(select ID_TAIKHOAN from TAI_KHOAN where SDT = '012235318'), (select ID_TAIKHOAN from TAI_KHOAN where SDT = '012340078'), '2024-03-01');
go

INSERT INTO THUOC_SD(ID_BA,ID_THUOC,SOLUONG) VALUES
((select top 1 ID_BA from BENH_AN inner join TAI_KHOAN on ID_KH=ID_TAIKHOAN where SDT = '012235318' ORDER BY NGAYKHAM DESC), (select top 1 ID_THUOC from THUOC where TENTHUOC = N'Lisinopril'), 5),
((select top 1 ID_BA from BENH_AN inner join TAI_KHOAN on ID_KH=ID_TAIKHOAN where SDT = '012235318' ORDER BY NGAYKHAM DESC), (select top 1 ID_THUOC from THUOC where TENTHUOC = N'Ibuprofen'),  10),
((select top 1 ID_BA from BENH_AN inner join TAI_KHOAN on ID_KH=ID_TAIKHOAN where SDT = '012235318' ORDER BY NGAYKHAM DESC), (select top 1 ID_THUOC from THUOC where TENTHUOC = N'Omeprazole'), 15);

INSERT INTO DICHVU_SD(ID_DVSD, ID_LOAIDV, THANHTIEN, ID_HOADON, ID_BA) VALUES
(cast(NEWID() as varchar(255)), (SELECT TOP 1 ID_LOAIDV FROM LOAI_DV WHERE TENDV = N'Dịch vụ 1') ,(SELECT TOP 1 GIATIEN FROM LOAI_DV WHERE TENDV = N'Dịch vụ 1'), NULL, (select top 1 ID_BA from BENH_AN inner join TAI_KHOAN on ID_KH=ID_TAIKHOAN where SDT = '012235318'ORDER BY NGAYKHAM DESC) )

 
-- test
DECLARE @BA VARCHAR(255)
DECLARE @NV VARCHAR(255)
SELECT TOP 1  @BA = ID_BA  FROM BENH_AN BA join TAI_KHOAN TK ON TK.ID_TAIKHOAN = BA.ID_KH WHERE TK.SDT = '012235318' ORDER BY NGAYKHAM DESC
SELECT @NV = ID_TAIKHOAN FROM TAI_KHOAN WHERE SDT = '012345678'

EXEC SP_NV_LAPHOADON @NV, @BA
GO

SELECT * 
FROM HOA_DON

SELECT *
FROM THUOC_SD

SELECT TOP 1    *
FROM BENH_AN BA join TAI_KHOAN TK 
ON TK.ID_TAIKHOAN = BA.ID_KH
WHERE TK.SDT = '012235318'
ORDER BY NGAYKHAM DESC

SELECT * 
FROM THUOC

select *
from LOAI_DV

UPDATE DICHVU_SD
SET ID_HOADON = NULL;

delete
FROM HOA_DON
WHERE ID_NV ='06DC015C-083B-4339-B0C3-6C8D025C4F42'AND ID_BA= '3A4BCB0F-931C-40DD-934A-9A13F4D911AA'

SELECT *
FROM DICHVU_SD
